import{_ as s,o as a,c as n,ak as i}from"./chunks/framework.CMX7UUIo.js";const k=JSON.parse('{"title":"Architecture","description":"","frontmatter":{},"headers":[],"relativePath":"architecture/overview.md","filePath":"architecture/overview.md","lastUpdated":1772002540000}'),r={name:"architecture/overview.md"};function l(t,e,c,o,p,d){return a(),n("div",null,[...e[0]||(e[0]=[i(`<h1 id="architecture" tabindex="-1">Architecture <a class="header-anchor" href="#architecture" aria-label="Permalink to “Architecture”">​</a></h1><p>This page describes the architecture that is currently implemented in code.</p><h2 id="diagram" tabindex="-1">Diagram <a class="header-anchor" href="#diagram" aria-label="Permalink to “Diagram”">​</a></h2><div class="language-mermaid line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">flowchart LR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  subgraph GUI[&quot;GUI Runtime (Electron + React)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    R[&quot;Renderer\\nsrc/App.tsx\\nsrc/hooks/useOrchestrator.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    P[&quot;Preload Bridge\\nelectron/preload.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    M[&quot;Electron Main\\nelectron/main.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    GM[&quot;Git Manager\\nelectron/gitManager.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PM[&quot;PTY Manager\\nelectron/ptyManager.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    AS[&quot;Agent Control Server\\nelectron/agentServer.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FS[&quot;Fleet Store\\nelectron/fleetStore.ts&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  subgraph CORE[&quot;Core Services (Shared)&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    G[&quot;Git Service\\npackages/core/src/services/git-service.js&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    T[&quot;PTY Service\\npackages/core/src/services/pty-service.js&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  subgraph DAEMON[&quot;Headless Core Daemon&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    D[&quot;Core Daemon HTTP + SSE\\npackages/core/src/daemon.js&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    C[&quot;Core CLI\\npackages/core/bin/forkline-core.js&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  subgraph PROTOCOL[&quot;Shared Protocol&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    PR[&quot;packages/protocol/src/index.js\\npty-state-machine.js\\nquick-actions.js&quot;]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  A[&quot;External Agent CLI&quot;] --&gt;|&quot;POST /api/task/:taskId/:action&quot;| AS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  R --&gt; P --&gt; M</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  M --&gt; GM --&gt; G</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  M --&gt; PM --&gt; T</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  M --&gt; AS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  M --&gt; FS</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  D --&gt; G</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  D --&gt; T</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  C --&gt; D</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  R --&gt; PR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  M --&gt; PR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  D --&gt; PR</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h2 id="runtime-modes" tabindex="-1">Runtime modes <a class="header-anchor" href="#runtime-modes" aria-label="Permalink to “Runtime modes”">​</a></h2><h3 id="gui-mode-electron-react" tabindex="-1">GUI mode (Electron + React) <a class="header-anchor" href="#gui-mode-electron-react" aria-label="Permalink to “GUI mode (Electron + React)”">​</a></h3><ul><li>Entry: <code>electron/main.ts</code></li><li>Renderer: <code>src/App.tsx</code> + <code>src/hooks/useOrchestrator.ts</code></li><li>Preload bridge: <code>electron/preload.ts</code> and <code>src/global.d.ts</code></li><li>Git orchestration: <code>electron/gitManager.ts</code> -&gt; <code>packages/core/src/services/git-service.js</code></li><li>PTY orchestration: <code>electron/ptyManager.ts</code> -&gt; <code>packages/core/src/services/pty-service.js</code></li><li>Agent control HTTP server: <code>electron/agentServer.ts</code></li><li>Fleet persistence: <code>electron/fleetStore.ts</code></li></ul><h3 id="core-daemon-mode-headless" tabindex="-1">Core daemon mode (headless) <a class="header-anchor" href="#core-daemon-mode-headless" aria-label="Permalink to “Core daemon mode (headless)”">​</a></h3><ul><li>CLI entry: <code>packages/core/bin/forkline-core.js</code></li><li>HTTP + SSE server: <code>packages/core/src/daemon.js</code></li><li>Services: <ul><li><code>packages/core/src/services/git-service.js</code></li><li><code>packages/core/src/services/pty-service.js</code></li></ul></li></ul><h2 id="shared-contract" tabindex="-1">Shared contract <a class="header-anchor" href="#shared-contract" aria-label="Permalink to “Shared contract”">​</a></h2><ul><li><code>packages/protocol/src/index.js</code></li><li><code>packages/protocol/src/pty-state-machine.js</code></li><li><code>packages/protocol/src/quick-actions.js</code></li></ul><h2 id="implemented-request-paths" tabindex="-1">Implemented request paths <a class="header-anchor" href="#implemented-request-paths" aria-label="Permalink to “Implemented request paths”">​</a></h2><h3 id="worktree-path-gui" tabindex="-1">Worktree path (GUI) <a class="header-anchor" href="#worktree-path-gui" aria-label="Permalink to “Worktree path (GUI)”">​</a></h3><ol><li>Renderer calls <code>window.electronAPI.createWorktree(...)</code>.</li><li>Preload sends <code>git:createWorktree</code>.</li><li><code>electron/gitManager.ts</code> calls <code>GitService.createWorktree(...)</code>.</li><li><code>GitService</code> performs git worktree/branch operations.</li></ol><h3 id="pty-path-gui" tabindex="-1">PTY path (GUI) <a class="header-anchor" href="#pty-path-gui" aria-label="Permalink to “PTY path (GUI)”">​</a></h3><ol><li>Renderer sends <code>pty:create</code>, <code>pty:write</code>, <code>pty:resize</code>, etc.</li><li><code>electron/ptyManager.ts</code> calls <code>PtyService</code>.</li><li>PTY output/state events are pushed back over IPC channels (<code>pty:data:&lt;taskId&gt;</code>, <code>pty:mode:&lt;taskId&gt;</code>, <code>pty:exit:&lt;taskId&gt;</code>).</li></ol><h3 id="agent-approval-path-gui" tabindex="-1">Agent approval path (GUI) <a class="header-anchor" href="#agent-approval-path-gui" aria-label="Permalink to “Agent approval path (GUI)”">​</a></h3><ol><li>Agent sends HTTP to <code>AgentControlServer</code> (<code>/api/task/:taskId/:action</code>).</li><li><code>electron/agentServer.ts</code> validates loopback + token + action.</li><li>For approval-required actions, renderer receives <code>agent:request</code>.</li><li>Renderer responds with <code>agent:respond</code> and decision is returned/persisted.</li></ol><h3 id="core-api-path" tabindex="-1">Core API path <a class="header-anchor" href="#core-api-path" aria-label="Permalink to “Core API path”">​</a></h3><ol><li>Core daemon serves <code>/v1/*</code> routes from <code>daemon.js</code>.</li><li>Any local client can call core HTTP routes and subscribe to <code>/v1/events</code>.</li></ol><h2 id="security-boundaries-in-code" tabindex="-1">Security boundaries in code <a class="header-anchor" href="#security-boundaries-in-code" aria-label="Permalink to “Security boundaries in code”">​</a></h2><ul><li>Loopback-only request acceptance in <code>packages/core/src/daemon.js</code> and <code>electron/agentServer.ts</code>.</li><li>Token auth checks in both servers.</li><li>Browser-origin request rejection in both servers.</li><li>Request and PTY payload limits enforced in server/service layers.</li></ul>`,22)])])}const u=s(r,[["render",l]]);export{k as __pageData,u as default};
